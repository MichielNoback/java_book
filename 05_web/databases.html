

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>36. Database interaction &#8212; The Java Track</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '05_web/databases';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="37. A simple web service using Ajax" href="ajax.html" />
    <link rel="prev" title="35. Servlet details and lifecycle hooks" href="servlet_details.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/java_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/java_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../keyboard_shortcuts.html">Keyboard shortcuts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_getting_started/intellij.html">1. A first IntelliJ project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_getting_started/essentials.html">2. The essence of Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_getting_started/basic_program_design.html">3. Basic program structure and flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_getting_started/first_look_at_objects.html">4. Objects and classes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Syntax</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../02_syntax/data_types.html">5. Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_syntax/arrays.html">6. Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_syntax/operators.html">7. Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_syntax/flow_control.html">8. Flow control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_syntax/methods.html">9. Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_syntax/packages_imports.html">10. Packages and Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_syntax/naming_commenting.html">11. Naming and commenting stuff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_syntax/demo_case_naming.html">12. The power of naming</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - Core APIs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../03_apis/interfaces.html">13. Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_apis/collections.html">14. The Java Collections API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_apis/class_object_methods.html">15. Methods of class Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_apis/records.html">16. Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_apis/sorting.html">17. Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_apis/exceptions.html">18. Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_apis/io.html">19. File IO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_apis/regex.html">20. Regular Expressions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 4 - OOP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../04_oop/encapsulation.html">21. Encapsulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_oop/access_modifiers.html">22. Access modifiers &amp; Other keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_oop/inheritance.html">23. Inheritance and UML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_oop/enums.html">24. Enums: constants on steroids</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_oop/encapsulation_revisited.html">25. Encapsulation revisited</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_oop/design_rules.html">26. Design rules summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_oop/inner_classes.html">27. Inner classes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 5 - Web Apps</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="refresher.html">28. A refresher</a></li>
<li class="toctree-l1"><a class="reference internal" href="toolbox.html">29. The toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_project.html">30. A first project</a></li>
<li class="toctree-l1"><a class="reference internal" href="mvc.html">31. Implementing MVC</a></li>
<li class="toctree-l1"><a class="reference internal" href="thymeleaf_expressions.html">32. Thymeleaf expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="thymeleaf_flow_control.html">33. Thymeleaf flow control and fragments</a></li>
<li class="toctree-l1"><a class="reference internal" href="sessions.html">34. Sessions &amp; Scopes</a></li>
<li class="toctree-l1"><a class="reference internal" href="servlet_details.html">35. Servlet details and lifecycle hooks</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">36. Database interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ajax.html">37. A simple web service using Ajax</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters_upload.html">38. Web filters and File uploads</a></li>
<li class="toctree-l1"><a class="reference internal" href="webbased_exercises1.html">39. Exercises intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="html_cheatsheet.html">40. HTML5 tags</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 6 - Leftovers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../06_leftovers/JUnit_basics.html">41. JUnit 5 basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_leftovers/JUnit_advanced.html">42. JUnit 5 advanced features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_leftovers/UML.html">43. UML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_leftovers/demo_case_refactoring.html">44. Demo case refactoring</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 7 - Spring (Boot)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../07_spring/REST_and_MVC_with_spring.html">45. REST and MVC with Spring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_spring/Dependency_injection.html">46. Dependency Injection in Spring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_spring/spring_annotations.html">47. Core (Spring) annotations</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/05_web/databases.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Database interaction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jdbc">36.1. JDBC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-database">36.1.1. The database</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model-classes">36.1.2. The model classes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#database-actions-within-intellij">36.1.3. Database actions within IntelliJ</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-data-to-the-db">36.1.4. Add data to the DB</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-naive-implementation">36.2. The naive implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jdbc-class-loading">36.2.1. JDBC class loading</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-connection">36.2.2. Create a Connection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#improve-on-naive-implementation">36.3. Improve on naive implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#externalize-your-credentials">36.3.1. Externalize your credentials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-preparedstatements">36.3.2. Use PreparedStatements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#traversing-results">36.3.3. Traversing results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-against-interfaces">36.4. Code against interfaces</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#refactoring-to-oo-principles">36.5. Refactoring to OO principles</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interface-definition">36.5.1. 1: An interface definition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-an-interface-implementer">36.5.2. 2: Create an interface implementer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-factory-class">36.5.3. 3: Create a <strong><em>factory class</em></strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#have-the-correct-type-instantiated">36.5.4. 4: Have the correct type instantiated</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-interface-type-in-your-code-base">36.5.5. 5: Use the interface type in your code base</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#singleton">36.6. Singleton</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-in-a-servlet-environment">36.7. Use in a servlet environment</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="database-interaction">
<h1><span class="section-number">36. </span>Database interaction<a class="headerlink" href="#database-interaction" title="Permalink to this headline">#</a></h1>
<p>In this post, these topics will be discussed:</p>
<ul class="simple">
<li><p>Database interaction with Java applications: JDBC</p></li>
<li><p>Java design issues that ensure flexible, reusable code that will easily deal with changing specs:</p>
<ul>
<li><p>a different database provider</p></li>
<li><p>a different view</p></li>
<li><p>different analysis components</p></li>
<li><p>etc etc</p></li>
</ul>
</li>
</ul>
<p>Just remember: <strong><em>the only constant in programming is change</em></strong>.</p>
<p>⇒ Have a look at the <a class="reference external" href="https://bitbucket.org/minoba/java_web_thymeleaf_demo">repo</a> to see the full code of these examples.</p>
<div class="section" id="jdbc">
<h2><span class="section-number">36.1. </span>JDBC<a class="headerlink" href="#jdbc" title="Permalink to this headline">#</a></h2>
<p>Having Java applications talk with MySQL databases require that you have the required Driver in your project class path. Let’s start with that. Put this line in te dependencies section of your <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// https://mvnrepository.com/artifact/mysql/mysql-connector-java  </span>
<span class="nx">compile</span><span class="w"> </span><span class="nx">group</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mysql-connector-java&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;5.1.6&#39;</span>
</pre></div>
</div>
<p>You may need to refresh your Gradle project in the Gradle Tool window, if you did not check the auto refresh option when creating the project.</p>
<p><img alt="Refresh project" src="../_images/refresh_gradle_project.png" /></p>
<div class="section" id="the-database">
<h3><span class="section-number">36.1.1. </span>The database<a class="headerlink" href="#the-database" title="Permalink to this headline">#</a></h3>
<p>Of course, you will need a MySQL server, a database and an account. Deal with that first before proceeding, if you don’t have that!</p>
<p>Suppose we have a database called MyDB with this single, simple table <code class="docutils literal notranslate"><span class="pre">Users</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">user_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">AUTO-INCREMENT</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">user_name</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varchar(30)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">user_password</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varchar(30)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">user_email</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">varchar(30)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">role</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">enum('GUEST',</span> <span class="pre">'USER',</span> <span class="pre">'ADMIN')</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-model-classes">
<h3><span class="section-number">36.1.2. </span>The model classes<a class="headerlink" href="#the-model-classes" title="Permalink to this headline">#</a></h3>
<p>These are the model classes that play a role in this chapter on database interaction.
Class <code class="docutils literal notranslate"><span class="pre">User</span></code>, a class that models visitors/users of a website:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.model</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Objects</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">User</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">User</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">role</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">User</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">role</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPassword</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRole</span><span class="p">(</span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">role</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getEmail</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPassword</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Role</span><span class="w"> </span><span class="nf">getRole</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">role</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//toString(), equals(), hashCode() and getSome() omitted</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The enum <code class="docutils literal notranslate"><span class="pre">Role</span></code>, modelling the role that website users can have:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.model</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">Role</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">GUEST</span><span class="p">,</span>
<span class="w">    </span><span class="n">USER</span><span class="p">,</span>
<span class="w">    </span><span class="n">ADMIN</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and my custom Exception type that encapsulates all exceptions that can occur during database interaction:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.dao</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DatabaseException</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DatabaseException</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DatabaseException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DatabaseException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">cause</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">cause</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DatabaseException</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">cause</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">cause</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="nf">DatabaseException</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">cause</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">enableSuppression</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">writableStackTrace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">cause</span><span class="p">,</span><span class="w"> </span><span class="n">enableSuppression</span><span class="p">,</span><span class="w"> </span><span class="n">writableStackTrace</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="database-actions-within-intellij">
<h3><span class="section-number">36.1.3. </span>Database actions within IntelliJ<a class="headerlink" href="#database-actions-within-intellij" title="Permalink to this headline">#</a></h3>
<p>IntelliJ has excellent support for databases: it has an internal MySQL console, and supports autocomplete on in-code SQL statements and sql scripts.</p>
<p>To get this Database toolbox support active, you need let IntelliJ know about the database and follow these steps:</p>
<ul class="simple">
<li><p>View → Tool Windows → Database</p></li>
<li><p>Click “+” → Data Source → MySQL</p></li>
</ul>
<p><img alt="Add datasource 1" src="../_images/add_datasource1.png" /></p>
<ul class="simple">
<li><p>Fill in the blanks (note: you may <strong>not</strong> have a localhost MySQL server. Instead, it may run on some specific URL such as <code class="docutils literal notranslate"><span class="pre">mysql.bin</span></code>)</p></li>
</ul>
<p><img alt="Add datasource 2" src="../_images/add_datasource2.png" /></p>
<ul class="simple">
<li><p>Click “download missing driver files”</p></li>
<li><p>Click “test connection”</p></li>
</ul>
<p>Note the URL it creates. Check that the data provided corresponds with your situation (Host, Database, User and Password).</p>
<ul class="simple">
<li><p>Open the MySQL console (double-click the data source in the Databases panel),</p></li>
<li><p>Enter a command</p></li>
<li><p>Press <code class="docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">enter</span></code></p></li>
</ul>
<p><img alt="Add datasource 3" src="../_images/add_datasource3.png" /></p>
</div>
<div class="section" id="add-data-to-the-db">
<h3><span class="section-number">36.1.4. </span>Add data to the DB<a class="headerlink" href="#add-data-to-the-db" title="Permalink to this headline">#</a></h3>
<p>First, a simple table is defined and created, and some preliminary dummy data is entered.</p>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">Users</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">auto_increment</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_name</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_password</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_email</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_role</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">(</span><span class="n">user_id</span><span class="p">));</span>
<span class="w">    </span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="p">(</span><span class="n">user_name</span><span class="p">,</span><span class="w"> </span><span class="n">user_password</span><span class="p">,</span><span class="w"> </span><span class="n">user_email</span><span class="p">,</span><span class="w"> </span><span class="n">user_role</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Henk&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Henkie&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Henk@example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ADMIN&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Of course, <strong><em>storing a user password unencrypted is a very bad idea</em></strong>. We will address this aspect later.</p>
<p>Next, have a look at the DB tool window:</p>
<p><img alt="Add datasource 4" src="../_images/add_datasource4.png" /></p>
</div>
</div>
<div class="section" id="the-naive-implementation">
<h2><span class="section-number">36.2. </span>The naive implementation<a class="headerlink" href="#the-naive-implementation" title="Permalink to this headline">#</a></h2>
<p>Here follow some classes demonstrating the general usage of database interaction components.
You should not implement your logic like this - it is inefficient, not OO, and very ugly.
A better solution follows later in this chapter.
Study this class carefully so you understand how everything works at the syntax level.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.dao</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.model.Role</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.model.User</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.*</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">VerySimpleDbConnector</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">connection</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * a main for demonstration purposes</span>
<span class="cm">     * @param args</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//connect</span>
<span class="w">            </span><span class="n">VerySimpleDbConnector</span><span class="w"> </span><span class="n">connector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">VerySimpleDbConnector</span><span class="p">(</span><span class="s">&quot;&lt;host&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;db-user&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;db-password&quot;</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//insert a user</span>
<span class="w">            </span><span class="n">connector</span><span class="p">.</span><span class="na">insertUser</span><span class="p">(</span><span class="s">&quot;Piet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pietissafe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;piet@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Role</span><span class="p">.</span><span class="na">ADMIN</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//fetch a user</span>
<span class="w">            </span><span class="n">connector</span><span class="p">.</span><span class="na">getUser</span><span class="p">(</span><span class="s">&quot;Piet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pietissafe&quot;</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//a catch-all for database interaction exceptions</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DatabaseException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">VerySimpleDbConnector</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">dbUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbUser</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">dbPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">;</span>

<span class="w">        </span><span class="c1">//make the connection</span>
<span class="w">        </span><span class="n">connect</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">connect</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//load driver class</span>
<span class="w">            </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//create connection</span>
<span class="w">            </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//..which is risky</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">(</span><span class="s">&quot;Something is wrong with the database, see cause Exception&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">getUser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userPass</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w">  </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//Prepare the SQL statement. The question marks are placeholders for repeated use with different data</span>
<span class="w">            </span><span class="c1">//!! Doing this within this method is extremely inefficient !!</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">fetchQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM Users WHERE user_name = ? AND user_password = ?&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">fetchQuery</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//set data on the &quot;?&quot; placeholders of the prepared statement</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">userName</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">userPass</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//execute</span>
<span class="w">            </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>

<span class="w">            </span><span class="c1">//if there is data, process it</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">userMail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;user_email&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">userIdStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">userRoleStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;user_role&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Role</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">userRoleStr</span><span class="p">);</span>
<span class="w">                </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">userMail</span><span class="p">,</span><span class="w"> </span><span class="n">userPass</span><span class="p">,</span><span class="w"> </span><span class="n">role</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">//close resources</span>
<span class="w">            </span><span class="n">rs</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">(</span><span class="s">&quot;Something is wrong with the database, see cause Exception&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">insertUser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userPass</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w">  </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="p">{</span>
<span class="w">            </span><span class="c1">//Prepare statement</span>
<span class="w">            </span><span class="c1">//!! Doing this within this method is extremely inefficient !!</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">insertQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO Users (user_name, user_password, user_email, user_role) &quot;</span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; VALUES (?, ?, ?, ?)&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">insertQuery</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//set data on the &quot;?&quot; placeholders of the prepared statement</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">userName</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">userPass</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">role</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>

<span class="w">            </span><span class="c1">//do the actual insert</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>

<span class="w">            </span><span class="c1">//close resources</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ex</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">(</span><span class="s">&quot;Something is wrong with the database, see cause Exception&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ex</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * close the connection!</span>
<span class="cm">     * @throws DatabaseException</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="jdbc-class-loading">
<h3><span class="section-number">36.2.1. </span>JDBC class loading<a class="headerlink" href="#jdbc-class-loading" title="Permalink to this headline">#</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This mechanism is called <strong><em>dynamic class loading</em></strong>. It loads the driver classes required for the MySQL interaction:</p>
</div>
<div class="section" id="create-a-connection">
<h3><span class="section-number">36.2.2. </span>Create a Connection<a class="headerlink" href="#create-a-connection" title="Permalink to this headline">#</a></h3>
<p>After loading the driver class(es), you need to establish a connection:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">dbUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jdbc:mysql://MyHost/MyDbName&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Fred&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">dbPass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;FredIsSafe&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">dbUrl</span><span class="p">,</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">dbPass</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that hardcoding your passwords in a repo that you are going to put online is a very bad idea; see the next section ofr a solution.</p>
</div>
</div>
<div class="section" id="improve-on-naive-implementation">
<h2><span class="section-number">36.3. </span>Improve on naive implementation<a class="headerlink" href="#improve-on-naive-implementation" title="Permalink to this headline">#</a></h2>
<div class="section" id="externalize-your-credentials">
<h3><span class="section-number">36.3.1. </span>Externalize your credentials<a class="headerlink" href="#externalize-your-credentials" title="Permalink to this headline">#</a></h3>
<p>I have created a small helper app that you can use to prevent storing passwords in your code. It reads your credentials from the <code class="docutils literal notranslate"><span class="pre">.my.cnf</span></code> file stored in your home folder.</p>
<p>You can clone and build the <a class="reference external" href="https://bitbucket.org/michiel_noback/dbutils">repo</a>
or download the jar <a class="reference download internal" download="" href="../_downloads/2f14ec432c5e66a4103db3fac02866d0/DButils-1.0.2.jar"><span class="xref download myst">here</span></a> and put it in your build path by adding the following line to the <code class="docutils literal notranslate"><span class="pre">build/gradle</span></code> file:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">compile</span><span class="w"> </span><span class="nf">files</span><span class="o">(</span><span class="s1">&#39;path/to/library/folder/DButils-1.0.2.jar&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>When you have it on the build path, simply use it as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">DbUser</span><span class="w"> </span><span class="n">dbUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DbCredentials</span><span class="p">.</span><span class="na">getMySQLuser</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbUser</span><span class="p">.</span><span class="na">getUserName</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">passWrd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbUser</span><span class="p">.</span><span class="na">getDatabasePassword</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbUser</span><span class="p">.</span><span class="na">getHost</span><span class="p">();</span>
<span class="n">String</span><span class="w"> </span><span class="n">dbName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbUser</span><span class="p">.</span><span class="na">getDatabaseName</span><span class="p">();</span>
</pre></div>
</div>
<p>assuming you have a <code class="docutils literal notranslate"><span class="pre">.my.cnf</span></code> file in your home folder and it has the correct entries:</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">[client]</span>
<span class="na">user</span><span class="o">=</span><span class="s">&lt;db user name&gt;</span>
<span class="na">password</span><span class="o">=</span><span class="s">&lt;db password&gt;</span>
<span class="na">host</span><span class="o">=</span><span class="s">localhost</span>
<span class="na">database</span><span class="o">=</span><span class="s">&lt;default database&gt;</span>
</pre></div>
</div>
<p>Once you establish the connection, you have a live <code class="docutils literal notranslate"><span class="pre">java.sql.Connection</span></code> object.
Talking to a database -an external resource- is “risky” business, so you have to put it in a try/catch block.
In a real app, you should do something else with the exception than print it of course, but this post is not about exception handling.</p>
</div>
<div class="section" id="use-preparedstatements">
<h3><span class="section-number">36.3.2. </span>Use PreparedStatements<a class="headerlink" href="#use-preparedstatements" title="Permalink to this headline">#</a></h3>
<p>Use PreparedStatements for interacting with the database.
Using <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> instances makes it easier and far more efficient to repeat a query. Here is one of the two queries that are required for implementing the interface methods.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">GET_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;get_user&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * prepares prepared statements for reuse</span>
<span class="cm">     * @throws SQLException</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">prepareStatements</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">fetchQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM Users WHERE user_name = ? AND user_password = ?&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">fetchQuery</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">preparedStatements</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">GET_USER</span><span class="p">,</span><span class="w"> </span><span class="n">ps</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>The prepared statements are stored as entries of a Map, which is an instance variable of the class <code class="docutils literal notranslate"><span class="pre">MyAppDaoMySQL.</span> <span class="pre">The</span> </code>?` characters serve as placeholders, to be replaced with actual values before executing the statement. See next section.</p>
</div>
<div class="section" id="traversing-results">
<h3><span class="section-number">36.3.3. </span>Traversing results<a class="headerlink" href="#traversing-results" title="Permalink to this headline">#</a></h3>
<p>Results can be traversed through the <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code> object that you get back from <code class="docutils literal notranslate"><span class="pre">ResultSet</span> <span class="pre">rs</span> <span class="pre">=</span> <span class="pre">ps.executeQuery();</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//process results</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Here, you see the use of <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">(rs.next())</span> <span class="pre">{}</span></code> which is not entirely logical if you expect a single result, as in this case (checking for a registered user). Maybe it is better to add some checks, such as:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getFetchSize</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">(</span><span class="s">&quot;something wrong&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now the low level code details are ready and known, let’s implement this in a better way.</p>
</div>
</div>
<div class="section" id="code-against-interfaces">
<h2><span class="section-number">36.4. </span>Code against interfaces<a class="headerlink" href="#code-against-interfaces" title="Permalink to this headline">#</a></h2>
<p>Code against interfaces, not implementations.</p>
<p>Suppose you start working on a website with a MySQL database as backend data layer. You think “encapsulation”, and create a class responsible for all database interaction (<code class="docutils literal notranslate"><span class="pre">MyMySqlDbConnector</span></code>), and use this class all over our code base. Something like this:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">MyMySqlDbConnector</span><span class="w"> </span><span class="n">dbConnector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyMySqlDbConnector</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">pass</span><span class="p">);</span>
</pre></div>
</div>
<p>Next year, after our application has grown, we decide a <strong><em>key-value store</em></strong> such as Couchbase is better suited for our growing customer base. We create a new class, <code class="docutils literal notranslate"><span class="pre">MyCouchbaseConnector</span></code>. Unfortunately, everywhere we used the MySQL connector, we need to change our code to the new implementation.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">MyCouchbaseConnector</span><span class="w"> </span><span class="n">dbConnector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyCouchbaseConnector</span><span class="p">();</span>
</pre></div>
</div>
<p>And if we are unlucky, the <code class="docutils literal notranslate"><span class="pre">MyCouchbaseConnector</span></code> has differing method signatures as well, making the refactoring process a hellish job.</p>
<p>That is such an unnecessary waste of time if we would have adhered to one of the prime directives of OO programming: <strong>Code against interfaces not implementations</strong> (where interface may mean interface as type, but also abstract class).</p>
</div>
<div class="section" id="refactoring-to-oo-principles">
<h2><span class="section-number">36.5. </span>Refactoring to OO principles<a class="headerlink" href="#refactoring-to-oo-principles" title="Permalink to this headline">#</a></h2>
<p>This principle is outlined in the following series of steps.</p>
<div class="section" id="an-interface-definition">
<h3><span class="section-number">36.5.1. </span>1: An interface definition<a class="headerlink" href="#an-interface-definition" title="Permalink to this headline">#</a></h3>
<p>Think long and hard about the contract: which methods do you need, disregarding the technology behind the scenes?
This will be your interface definition.
Here is the interface specifying my user database interactions:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.dao</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.model.Role</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.model.User</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">MyAppDao</span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">    * connection logic should be put here.</span>
<span class="cm">    * @throws DatabaseException</span>
<span class="cm">    */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">connect</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">    * shutdown logic should be put here</span>
<span class="cm">    * @throws DatabaseException</span>
<span class="cm">    */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">    * fetches a user by username and password.</span>
<span class="cm">    * @param userName</span>
<span class="cm">    * @param userPass</span>
<span class="cm">    * @return</span>
<span class="cm">    * @throws DatabaseException</span>
<span class="cm">    */</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">getUser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userPass</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">    * inserts a new User.</span>
<span class="cm">    * @param userName</span>
<span class="cm">    * @param userPass</span>
<span class="cm">    * @param email</span>
<span class="cm">    * @param role</span>
<span class="cm">    * @throws DatabaseException</span>
<span class="cm">    */</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">insertUser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userPass</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="create-an-interface-implementer">
<h3><span class="section-number">36.5.2. </span>2: Create an interface implementer<a class="headerlink" href="#create-an-interface-implementer" title="Permalink to this headline">#</a></h3>
<p>Here is the complete class. It of course implements all interface methods.
The Singleton pattern will be explained below.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.dao</span><span class="p">;</span>
<span class="c1">//imports omitted</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyAppDaoMySQL</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">MyAppDao</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">GET_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;get_user&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">INSERT_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;insert_user&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">connection</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">PreparedStatement</span><span class="o">&gt;</span><span class="w"> </span><span class="n">preparedStatements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/*singleton pattern*/</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MyAppDaoMySQL</span><span class="w"> </span><span class="n">uniqueInstance</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * singleton pattern</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">MyAppDaoMySQL</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">dbUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbUser</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">dbPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * singleton pattern</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MyAppDaoMySQL</span><span class="w"> </span><span class="nf">getInstance</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//lazy</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uniqueInstance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">uniqueInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyAppDaoMySQL</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">uniqueInstance</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">connect</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">);</span>
<span class="w">            </span><span class="n">prepareStatements</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">(</span><span class="s">&quot;Something is wrong with the database, see cause Exception&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * prepares prepared statements for reuse</span>
<span class="cm">     * @throws SQLException</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">prepareStatements</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">fetchQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM Users WHERE user_name = ? AND user_password = ?&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">fetchQuery</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">preparedStatements</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">GET_USER</span><span class="p">,</span><span class="w"> </span><span class="n">ps</span><span class="p">);</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">insertQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO Users (user_name, user_password, user_email, user_role) &quot;</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; VALUES (?, ?, ?, ?)&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">insertQuery</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">preparedStatements</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">INSERT_USER</span><span class="p">,</span><span class="w"> </span><span class="n">ps</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">getUser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userPass</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w">  </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">preparedStatements</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">GET_USER</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">userName</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">userPass</span><span class="p">);</span>
<span class="w">            </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">userMail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;user_email&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">userIdStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">userRoleStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;user_role&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Role</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">userRoleStr</span><span class="p">);</span>
<span class="w">                </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">userMail</span><span class="p">,</span><span class="w"> </span><span class="n">userPass</span><span class="p">,</span><span class="w"> </span><span class="n">role</span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">rs</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">(</span><span class="s">&quot;Something is wrong with the database, see cause Exception&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">insertUser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userPass</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">Role</span><span class="w"> </span><span class="n">role</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w">  </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="p">{</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">preparedStatements</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">INSERT_USER</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">userName</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">userPass</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">);</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">role</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="w">            </span><span class="n">ps</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ex</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">(</span><span class="s">&quot;Something is wrong with the database, see cause Exception&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ex</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/*After you are done, you must carefully clean up your database resources!*/</span>
<span class="w">        </span><span class="cm">/*These objects need to be closed explicitly:</span>
<span class="cm">         *  `ResultSet` (here: done in method itself)</span>
<span class="cm">         *  `PreparedStatemenent`</span>
<span class="cm">         *  `Connection` (always last)</span>
<span class="cm">         */</span>
<span class="w">        </span><span class="k">try</span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">preparedStatements</span><span class="p">.</span><span class="na">keySet</span><span class="p">()</span><span class="w"> </span><span class="p">){</span>
<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="na">preparedStatements</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">key</span><span class="p">).</span><span class="na">close</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">){</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">finally</span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-factory-class">
<h3><span class="section-number">36.5.3. </span>3: Create a <strong><em>factory class</em></strong><a class="headerlink" href="#create-a-factory-class" title="Permalink to this headline">#</a></h3>
<p>Here, class <code class="docutils literal notranslate"><span class="pre">MyAppDaoFactory</span></code> was created that will instantiate and serve the right type of implementer.
This should preferably be done based on some external configuration setting (such as <code class="docutils literal notranslate"><span class="pre">web.xml</span></code>).
Also note that the Database credentials are read from the external <code class="docutils literal notranslate"><span class="pre">.my.cnf</span></code> file here, using the
helper app discussed earlier.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">nl.bioinf.wis_on_thymeleaf.dao</span><span class="p">;</span>
<span class="c1">//imports deleted</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyAppDaoFactory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MyAppDao</span><span class="w"> </span><span class="n">daoInstance</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">    * Code should be called at application startup</span>
<span class="cm">    */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initializeDataSource</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">daoInstance</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;DAO can be initialized only once&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">switch</span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;dummy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">createDummyInstance</span><span class="p">();</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;mysql&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">createMySQLInstance</span><span class="p">();</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;unknown database type requested&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">    * serves the dao instance</span>
<span class="cm">    * @return</span>
<span class="cm">    */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MyAppDao</span><span class="w"> </span><span class="nf">getDataSource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">daoInstance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;DAO is not initialized; call initializeDataSource() first&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">daoInstance</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createDummyInstance</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">daoInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyAppDaoInMemory</span><span class="p">();</span>
<span class="w">        </span><span class="n">daoInstance</span><span class="p">.</span><span class="na">connect</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createMySQLInstance</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">DatabaseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">DbUser</span><span class="w"> </span><span class="n">mySQLuser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DbCredentials</span><span class="p">.</span><span class="na">getMySQLuser</span><span class="p">();</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">dbUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jdbc:mysql://&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mySQLuser</span><span class="p">.</span><span class="na">getHost</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mySQLuser</span><span class="p">.</span><span class="na">getDatabaseName</span><span class="p">();</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySQLuser</span><span class="p">.</span><span class="na">getUserName</span><span class="p">();</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">dbPass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mySQLuser</span><span class="p">.</span><span class="na">getDatabasePassword</span><span class="p">();</span>
<span class="w">            </span><span class="n">daoInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyAppDaoMySQL</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">dbUrl</span><span class="p">,</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">dbPass</span><span class="p">);</span>
<span class="w">            </span><span class="n">daoInstance</span><span class="p">.</span><span class="na">connect</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NoSuchFieldException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DatabaseException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="have-the-correct-type-instantiated">
<h3><span class="section-number">36.5.4. </span>4: Have the correct type instantiated<a class="headerlink" href="#have-the-correct-type-instantiated" title="Permalink to this headline">#</a></h3>
<p>Have the correct type instantiated at application startup.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">web.xml</span></code> deployment descriptor is an excellent place to specify which implementation of the <code class="docutils literal notranslate"><span class="pre">MyAppDao</span></code> interface to use:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">&lt;context-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>db-type<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>mysql<span class="nt">&lt;/param-value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/context-param&gt;</span>
</pre></div>
</div>
<p>The datasource needs to be initialized at application startup, requested from the class <code class="docutils literal notranslate"><span class="pre">MyAppDaoFactory</span></code>.
You have seen the application startup hook in a previous post (see <a class="reference internal" href="servlet_details.html"><span class="doc std std-doc">servlet details and lifecycle hooks</span></a>);
it was implemented in class <code class="docutils literal notranslate"><span class="pre">WebConfig</span></code>.
Here, the DAO initialization is done within that method, <code class="docutils literal notranslate"><span class="pre">contextInitialized()</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@WebListener</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ServletContextListener</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextInitialized</span><span class="p">(</span><span class="n">ServletContextEvent</span><span class="w"> </span><span class="n">servletContextEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//other code</span>

<span class="w">        </span><span class="c1">//fetch the database type</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">dbType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">servletContextEvent</span><span class="p">.</span><span class="na">getServletContext</span><span class="p">().</span><span class="na">getInitParameter</span><span class="p">(</span><span class="s">&quot;db-type&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">MyAppDaoFactory</span><span class="p">.</span><span class="na">initializeDataSource</span><span class="p">(</span><span class="n">dbType</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DatabaseException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="c1">//this should be logged of course; and dealt with elegantly</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">//other code</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="use-the-interface-type-in-your-code-base">
<h3><span class="section-number">36.5.5. </span>5: Use the interface type in your code base<a class="headerlink" href="#use-the-interface-type-in-your-code-base" title="Permalink to this headline">#</a></h3>
<p>It is now easy to get hold of the connector anywhere in our application because we can call the static method <code class="docutils literal notranslate"><span class="pre">getInstance()</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">MyAppDao</span><span class="w"> </span><span class="n">dao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyDbConnector</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="singleton">
<h2><span class="section-number">36.6. </span>Singleton<a class="headerlink" href="#singleton" title="Permalink to this headline">#</a></h2>
<p>I want class <code class="docutils literal notranslate"><span class="pre">DbCredentials</span></code> to be instantiated only once - we do not want to create resource-heavy classes twice if we can prevent it. To guarantee this, the <strong><em>singleton pattern</em></strong> is implemented.  It has three components:</p>
<ul class="simple">
<li><p>a private static instance</p></li>
<li><p>a private constructor (only this class can instantiate itself)</p></li>
<li><p>a public static method serving the single instance</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MyAppDaoMySQL</span><span class="w"> </span><span class="n">uniqueInstance</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">MyAppDaoMySQL</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">dbUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbUser</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">dbPassword</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">MyAppDaoMySQL</span><span class="w"> </span><span class="nf">getInstance</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//lazy instantiation</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uniqueInstance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">uniqueInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyAppDaoMySQL</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">dbUser</span><span class="p">,</span><span class="w"> </span><span class="n">dbPassword</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">uniqueInstance</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Key here is the private constructor which guarantees ony code within class <code class="docutils literal notranslate"><span class="pre">MyAppDaoMySQL</span></code> can instantiate its objects, and it does so only once.
This solution is simple, but <strong>not thread safe!</strong>. In a later course, we’ll revisit this.</p>
</div>
<div class="section" id="use-in-a-servlet-environment">
<h2><span class="section-number">36.7. </span>Use in a servlet environment<a class="headerlink" href="#use-in-a-servlet-environment" title="Permalink to this headline">#</a></h2>
<p>Here is the relevant servlet code:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">MyAppDao</span><span class="w"> </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyAppDaoFactory</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">();</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">.</span><span class="na">getUser</span><span class="p">(</span><span class="s">&quot;Henk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Henkie&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">TemplateEngine</span><span class="w"> </span><span class="n">templateEngine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WebConfig</span><span class="p">.</span><span class="na">getTemplateEngine</span><span class="p">();</span>
<span class="w">            </span><span class="n">WebContext</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebContext</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getServletContext</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getLocale</span><span class="p">());</span>
<span class="w">            </span><span class="n">ctx</span><span class="p">.</span><span class="na">setVariable</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="w">            </span><span class="n">templateEngine</span><span class="p">.</span><span class="na">process</span><span class="p">(</span><span class="s">&quot;user-details&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">getWriter</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DatabaseException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
</pre></div>
</div>
<p>and the thymeleaf view:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html SYSTEM &quot;http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd&quot;&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Show user<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;js/myPage.js&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;application/javascript&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="cm">&lt;!-- welcome message read from resource bundle welcome.html--&gt;</span>
<span class="p">&lt;</span><span class="nt">h2</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Welcome &#39; + ${user.name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h3</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Your account email: &#39; + ${user.email}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h3</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;&#39;Your Role: &#39; + ${user.role.name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Below you see the results with the two different values for the same <code class="docutils literal notranslate"><span class="pre">web.xml</span></code> context-param entry. The code does not know which implementation is running.</p>
<p><strong>db-type=mysql</strong><br />
Here, the MySQL database is queried:</p>
<p><img alt="Datasourse MySQL" src="../_images/datasource_mysql.png" /></p>
<p><strong>db-type=dummy</strong><br />
And this queries the internal dummy database:</p>
<p><img alt="Datasource Dummy" src="../_images/datasource_dummy.png" /></p>
<p>This constitutes the final layer in the app: the data layer:</p>
<p><img alt="MVC" src="../_images/mvc_with_data_layer.png" /></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./05_web"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="servlet_details.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">35. </span>Servlet details and lifecycle hooks</p>
      </div>
    </a>
    <a class="right-next"
       href="ajax.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">37. </span>A simple web service using Ajax</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jdbc">36.1. JDBC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-database">36.1.1. The database</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model-classes">36.1.2. The model classes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#database-actions-within-intellij">36.1.3. Database actions within IntelliJ</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#add-data-to-the-db">36.1.4. Add data to the DB</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-naive-implementation">36.2. The naive implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jdbc-class-loading">36.2.1. JDBC class loading</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-connection">36.2.2. Create a Connection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#improve-on-naive-implementation">36.3. Improve on naive implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#externalize-your-credentials">36.3.1. Externalize your credentials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-preparedstatements">36.3.2. Use PreparedStatements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#traversing-results">36.3.3. Traversing results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-against-interfaces">36.4. Code against interfaces</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#refactoring-to-oo-principles">36.5. Refactoring to OO principles</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-interface-definition">36.5.1. 1: An interface definition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-an-interface-implementer">36.5.2. 2: Create an interface implementer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-factory-class">36.5.3. 3: Create a <strong><em>factory class</em></strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#have-the-correct-type-instantiated">36.5.4. 4: Have the correct type instantiated</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-the-interface-type-in-your-code-base">36.5.5. 5: Use the interface type in your code base</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#singleton">36.6. Singleton</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-in-a-servlet-environment">36.7. Use in a servlet environment</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michiel Noback
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>